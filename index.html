<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SR事業部 AI予測分析システム</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.8.0/umd/Recharts.js"></script>
    <style>
        body {
            font-family: "Hiragino Sans", "Yu Gothic UI", "Meiryo", sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f0f9ff 0%, #ecfdf5 100%);
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 18px;
            color: #374151;
        }
        .error-fallback {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        SR事業部 AI予測分析システム 読み込み中...
    </div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // シンプルなアイコンコンポーネント
        const Store = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0 2-2V7a2 2 0 0 0-2 2H5a2 2 0 0 0-2 2z"/>
                <polyline points="3,9 21,9"/>
            </svg>
        );

        const TrendingUp = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="22,7 13.5,15.5 8.5,10.5 2,17"/>
                <polyline points="16,7 22,7 22,13"/>
            </svg>
        );

        const AlertTriangle = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                <line x1="12" y1="9" x2="12" y2="13"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
        );

        const Target = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="6"/>
                <circle cx="12" cy="12" r="2"/>
            </svg>
        );

        const MapPin = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
            </svg>
        );

        const Brain = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 2a3 3 0 0 0-3 3 4 4 0 0 0-4 4v6a4 4 0 0 0 4 4 3 3 0 0 0 3 3 3 3 0 0 0 3-3 4 4 0 0 0 4-4V9a4 4 0 0 0-4-4 3 3 0 0 0-3-3z"/>
            </svg>
        );

        // シンプルなチャートコンポーネント（Rechartsフォールバック）
        const SimpleChart = ({ data, type = "line" }) => {
            const maxValue = Math.max(...data.map(d => Math.max(d.予測売上 || 0, d.予測利益 || 0)));
            const chartHeight = 300;
            const chartWidth = 600;
            const padding = 40;

            if (type === "line") {
                return (
                    <div className="w-full bg-gray-50 p-4 rounded-lg">
                        <svg width="100%" height={chartHeight} viewBox={`0 0 ${chartWidth} ${chartHeight}`}>
                            <defs>
                                <linearGradient id="salesGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style={{stopColor:'#16a34a', stopOpacity:0.2}}/>
                                    <stop offset="100%" style={{stopColor:'#16a34a', stopOpacity:0}}/>
                                </linearGradient>
                            </defs>
                            
                            {/* グリッド線 */}
                            {[0, 1, 2, 3, 4].map(i => (
                                <g key={i}>
                                    <line
                                        x1={padding}
                                        y1={padding + (chartHeight - 2*padding) * i / 4}
                                        x2={chartWidth - padding}
                                        y2={padding + (chartHeight - 2*padding) * i / 4}
                                        stroke="#e5e7eb"
                                        strokeDasharray="3,3"
                                    />
                                </g>
                            ))}

                            {/* 売上予測ライン */}
                            <polyline
                                fill="none"
                                stroke="#16a34a"
                                strokeWidth="3"
                                points={data.map((d, i) => {
                                    const x = padding + (chartWidth - 2*padding) * i / (data.length - 1);
                                    const y = chartHeight - padding - ((d.予測売上 || 0) / maxValue) * (chartHeight - 2*padding);
                                    return `${x},${y}`;
                                }).join(' ')}
                            />

                            {/* データポイント */}
                            {data.map((d, i) => {
                                const x = padding + (chartWidth - 2*padding) * i / (data.length - 1);
                                const y = chartHeight - padding - ((d.予測売上 || 0) / maxValue) * (chartHeight - 2*padding);
                                return (
                                    <circle
                                        key={i}
                                        cx={x}
                                        cy={y}
                                        r="4"
                                        fill="#16a34a"
                                    />
                                );
                            })}

                            {/* 月ラベル */}
                            {data.map((d, i) => {
                                const x = padding + (chartWidth - 2*padding) * i / (data.length - 1);
                                return (
                                    <text
                                        key={i}
                                        x={x}
                                        y={chartHeight - 10}
                                        textAnchor="middle"
                                        fontSize="12"
                                        fill="#6b7280"
                                    >
                                        {d.month.slice(5)}
                                    </text>
                                );
                            })}
                        </svg>
                        <div className="mt-2 text-center text-sm text-gray-600">
                            <span className="inline-block w-4 h-0.5 bg-green-600 mr-2"></span>
                            売上予測（万円）
                        </div>
                    </div>
                );
            }

            return <div className="w-full h-64 bg-gray-100 flex items-center justify-center">チャート読み込み中...</div>;
        };

        const SRPredictionSystem = () => {
            const [selectedStore, setSelectedStore] = useState('全店舗統合');
            const [predictionPeriod, setPredictionPeriod] = useState('6ヶ月');
            const [analysisType, setAnalysisType] = useState('売上予測');
            const [viewMode, setViewMode] = useState('予測グラフ');
            const [isLoaded, setIsLoaded] = useState(false);
            const [error, setError] = useState(null);

            useEffect(() => {
                const timer = setTimeout(() => {
                    try {
                        document.getElementById('loading').style.display = 'none';
                        setIsLoaded(true);
                    } catch (err) {
                        console.error('Loading error:', err);
                        setError('システムの読み込みに失敗しました');
                    }
                }, 2000);

                return () => clearTimeout(timer);
            }, []);

            // SR事業部6店舗データ
            const storeData = {
                '清水店': { 月売上: 89, 営業利益: 24, 利益率: 26.97, 人件費: 31, 特性: '観光客多・土日強' },
                '静岡店': { 月売上: 95, 営業利益: 27, 利益率: 28.42, 人件費: 28, 特性: '安定顧客・平日強' },
                '掛川店': { 月売上: 78, 営業利益: 21, 利益率: 26.92, 人件費: 25, 特性: '地域密着・夜間強' },
                '市野店': { 月売上: 82, 営業利益: 23, 利益率: 28.05, 人件費: 24, 特性: '家族層・週末強' },
                '伊豆長岡店': { 月売上: 71, 営業利益: 18, 利益率: 25.35, 人件費: 22, 特性: '温泉客・季節性強' },
                '広島店': { 月売上: 110, 営業利益: 29, 利益率: 26.36, 人件費: 35, 特性: '都市部・通勤客強' }
            };

            // SR事業部特化型AI予測データ
            const srPredictionData = [
                { month: '2025-01', 予測売上: 567, 予測利益: 157, 信頼度: 89 },
                { month: '2025-02', 予測売上: 548, 予測利益: 151, 信頼度: 87 },
                { month: '2025-03', 予測売上: 592, 予測利益: 164, 信頼度: 91 },
                { month: '2025-04', 予測売上: 576, 予測利益: 159, 信頼度: 88 },
                { month: '2025-05', 予測売上: 601, 予測利益: 166, 信頼度: 92 },
                { month: '2025-06', 予測売上: 584, 予測利益: 161, 信頼度: 89 }
            ];

            // SR事業部専用AIアラート
            const srAlerts = [
                { type: 'opportunity', store: '伊豆長岡店', message: '3-5月観光シーズン：予測売上+18%増加見込み（スタッフ増員推奨）', priority: '高' },
                { type: 'risk', store: '広島店', message: '人件費上昇トレンド：来月+8%予測（効率化対策必要）', priority: '中' },
                { type: 'trend', store: '全店統合', message: '土日売上比重増加：平日対策で年間+340万円増収可能', priority: '高' },
                { type: 'maintenance', store: '掛川店', message: '設備更新時期：投資効果3年で回収見込み', priority: '中' }
            ];

            if (error) {
                return (
                    <div className="error-fallback">
                        <h1 className="text-2xl font-bold text-red-600 mb-4">システムエラー</h1>
                        <p className="text-gray-700">{error}</p>
                        <button 
                            onClick={() => window.location.reload()} 
                            className="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                        >
                            再読み込み
                        </button>
                    </div>
                );
            }

            if (!isLoaded) {
                return <div className="loading">SR事業部 AI予測分析システム 読み込み中...</div>;
            }

            return (
                <div className="max-w-7xl mx-auto p-6 bg-gradient-to-br from-blue-50 to-green-50 min-h-screen">
                    {/* SR事業部専用ヘッダー */}
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-6 border-l-4 border-green-500">
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-3">
                                    <Store className="text-green-600" />
                                    SR事業部 AI予測分析システム
                                </h1>
                                <p className="text-gray-600 mt-2">6店舗統合管理・季節性対応・観光需要予測</p>
                                <div className="flex items-center gap-4 mt-3 text-sm">
                                    <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full">6店舗稼働中</span>
                                    <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full">年間売上: 5,101万円</span>
                                    <span className="bg-purple-100 text-purple-800 px-3 py-1 rounded-full">営業利益率: 27.73%</span>
                                </div>
                            </div>
                            <div className="text-right">
                                <div className="text-sm text-gray-500">予測精度</div>
                                <div className="text-2xl font-bold text-green-600">91.2%</div>
                                <div className="text-xs text-gray-400">SR事業部特化型AI</div>
                            </div>
                        </div>
                    </div>

                    {/* 制御パネル */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div className="bg-white rounded-lg shadow p-4">
                            <label className="block text-sm font-medium text-gray-700 mb-2">店舗選択</label>
                            <select 
                                value={selectedStore} 
                                onChange={(e) => setSelectedStore(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"
                            >
                                <option value="全店舗統合">全店舗統合</option>
                                <option value="清水店">清水店</option>
                                <option value="静岡店">静岡店</option>
                                <option value="掛川店">掛川店</option>
                                <option value="市野店">市野店</option>
                                <option value="伊豆長岡店">伊豆長岡店</option>
                                <option value="広島店">広島店</option>
                            </select>
                        </div>
                        <div className="bg-white rounded-lg shadow p-4">
                            <label className="block text-sm font-medium text-gray-700 mb-2">分析期間</label>
                            <select 
                                value={predictionPeriod} 
                                onChange={(e) => setPredictionPeriod(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"
                            >
                                <option value="3ヶ月">3ヶ月予測</option>
                                <option value="6ヶ月">6ヶ月予測</option>
                                <option value="12ヶ月">年間予測</option>
                            </select>
                        </div>
                        <div className="bg-white rounded-lg shadow p-4">
                            <label className="block text-sm font-medium text-gray-700 mb-2">分析種別</label>
                            <select 
                                value={analysisType} 
                                onChange={(e) => setAnalysisType(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"
                            >
                                <option value="売上予測">売上予測</option>
                                <option value="利益予測">利益予測</option>
                                <option value="季節性分析">季節性分析</option>
                                <option value="店舗比較">店舗比較分析</option>
                            </select>
                        </div>
                        <div className="bg-white rounded-lg shadow p-4">
                            <label className="block text-sm font-medium text-gray-700 mb-2">表示モード</label>
                            <select 
                                value={viewMode} 
                                onChange={(e) => setViewMode(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"
                            >
                                <option value="予測グラフ">予測グラフ</option>
                                <option value="店舗分析">店舗分析</option>
                                <option value="パターン分析">パターン分析</option>
                            </select>
                        </div>
                    </div>

                    {/* SR事業部専用アラートシステム */}
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <AlertTriangle className="text-orange-500" />
                            SR事業部 AIアラート・推奨アクション
                        </h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {srAlerts.map((alert, index) => (
                                <div key={index} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                    <div className="flex items-start gap-3">
                                        <div className={`w-3 h-3 rounded-full mt-2 ${
                                            alert.type === 'risk' ? 'bg-red-500' :
                                            alert.type === 'opportunity' ? 'bg-green-500' :
                                            alert.type === 'trend' ? 'bg-blue-500' : 'bg-yellow-500'
                                        }`}></div>
                                        <div className="flex-1">
                                            <div className="flex items-center gap-2 mb-1">
                                                <span className="text-sm font-medium text-gray-600">{alert.store}</span>
                                                <span className={`text-xs px-2 py-1 rounded ${
                                                    alert.priority === '高' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'
                                                }`}>
                                                    優先度: {alert.priority}
                                                </span>
                                            </div>
                                            <p className="text-sm text-gray-700">{alert.message}</p>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* 予測グラフ */}
                    {viewMode === '予測グラフ' && (
                        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <TrendingUp className="text-green-600" />
                                SR事業部 {predictionPeriod}予測トレンド
                            </h2>
                            <SimpleChart data={srPredictionData} type="line" />
                        </div>
                    )}

                    {/* 店舗別詳細分析カード */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                        {Object.entries(storeData).map(([storeName, data]) => (
                            <div key={storeName} className="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
                                <div className="flex items-center justify-between mb-3">
                                    <h3 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                                        <MapPin className="text-green-600" />
                                        {storeName}
                                    </h3>
                                    <span className={`text-xs px-2 py-1 rounded-full ${
                                        data.利益率 > 27 ? 'bg-green-100 text-green-700' : 
                                        data.利益率 > 26 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'
                                    }`}>
                                        {data.利益率 > 27 ? '優秀' : data.利益率 > 26 ? '標準' : '要改善'}
                                    </span>
                                </div>
                                
                                <div className="space-y-2 mb-4">
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">月間売上</span>
                                        <span className="font-semibold text-green-600">{data.月売上}万円</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">営業利益</span>
                                        <span className="font-semibold text-blue-600">{data.営業利益}万円</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">利益率</span>
                                        <span className="font-semibold text-purple-600">{data.利益率}%</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">人件費</span>
                                        <span className="font-semibold text-orange-600">{data.人件費}万円</span>
                                    </div>
                                </div>
                                
                                <div className="border-t pt-3">
                                    <div className="text-sm text-gray-600 mb-2">店舗特性</div>
                                    <div className="text-sm text-gray-800">{data.特性}</div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* SR事業部サマリー・推奨アクション */}
                    <div className="bg-gradient-to-r from-green-100 to-blue-100 rounded-xl shadow-lg p-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <Target className="text-green-600" />
                            SR事業部 AI分析サマリー・次のアクション
                        </h2>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div className="text-center">
                                <div className="text-2xl font-bold text-green-600 mb-1">5,234万円</div>
                                <div className="text-sm text-gray-600">年間売上予測</div>
                                <div className="text-xs text-green-500">+2.6%成長</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-bold text-blue-600 mb-1">1,448万円</div>
                                <div className="text-sm text-gray-600">年間利益予測</div>
                                <div className="text-xs text-blue-500">27.67%利益率</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-bold text-purple-600 mb-1">340万円</div>
                                <div className="text-sm text-gray-600">改善余地</div>
                                <div className="text-xs text-purple-500">平日対策で実現</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-bold text-orange-600 mb-1">中リスク</div>
                                <div className="text-sm text-gray-600">季節性リスク</div>
                                <div className="text-xs text-orange-500">対策実装中</div>
                            </div>
                        </div>

                        <div className="bg-white bg-opacity-70 rounded-lg p-4">
                            <h3 className="font-bold text-gray-800 mb-2">今月の優先アクション:</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span className="font-medium text-green-700">• 伊豆長岡店:</span>
                                    <span className="text-gray-700"> 観光シーズン対応スタッフ増員</span>
                                </div>
                                <div>
                                    <span className="font-medium text-blue-700">• 広島店:</span>
                                    <span className="text-gray-700"> 人件費効率化・シフト最適化</span>
                                </div>
                                <div>
                                    <span className="font-medium text-purple-700">• 全店:</span>
                                    <span className="text-gray-700"> 平日集客強化施策実装</span>
                                </div>
                                <div>
                                    <span className="font-medium text-orange-700">• 掛川店:</span>
                                    <span className="text-gray-700"> 設備更新投資検討開始</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* フッター */}
                    <div className="mt-8 text-center text-sm text-gray-500">
                        <p>SR事業部 AI予測分析システム | システム稼働率: 99.9% | 最終更新: {new Date().toLocaleDateString('ja-JP')}</p>
                    </div>
                </div>
            );
        };

        // エラーハンドリング付きでレンダリング
        try {
            const container = document.getElementById('root');
            const root = ReactDOM.createRoot ? ReactDOM.createRoot(container) : null;
            
            if (root) {
                root.render(React.createElement(SRPredictionSystem));
            } else {
                ReactDOM.render(React.createElement(SRPredictionSystem), container);
            }
        } catch (error) {
            console.error('Rendering error:', error);
            document.getElementById('root').innerHTML = `
                <div class="error-fallback">
                    <h1 class="text-2xl font-bold text-red-600 mb-4">システムエラー</h1>
                    <p class="text-gray-700">システムの読み込みに失敗しました。ページを再読み込みしてください。</p>
                    <button onclick="window.location.reload()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                        再読み込み
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
