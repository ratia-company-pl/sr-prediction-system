<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>統合テストシステム - 4事業部統合PLマスターシステム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }
        
        .test-card {
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .status-pass { color: #10b981; }
        .status-fail { color: #ef4444; }
        .status-running { color: #f59e0b; }
        .status-pending { color: #6b7280; }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .test-log {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        .test-item {
            border-left: 4px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .test-item.pass {
            border-left-color: #10b981;
            background-color: #f0fdf4;
        }
        
        .test-item.fail {
            border-left-color: #ef4444;
            background-color: #fef2f2;
        }
        
        .test-item.running {
            border-left-color: #f59e0b;
            background-color: #fffbeb;
        }
        
        .spinning {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- ヘッダー -->
    <header class="gradient-header text-white shadow-xl">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="text-center">
                <h1 class="text-3xl lg:text-4xl font-bold mb-2">統合テストシステム</h1>
                <p class="text-xl text-purple-100 mb-4">4事業部統合PLマスターシステム - Phase 5</p>
                <div class="bg-white/20 rounded-lg p-3 inline-block">
                    <span class="text-sm">テスト実行日時: <span id="test-datetime">2024年12月19日</span> | ステータス: <span id="overall-status" class="font-bold">準備完了</span></span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- テスト実行コントロール -->
        <section class="test-card bg-white rounded-xl shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <div class="w-8 h-8 bg-blue-100 rounded-lg mr-3 flex items-center justify-center">
                    <span class="text-blue-600 font-bold">🎮</span>
                </div>
                テスト実行コントロール
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- テスト実行ボタン -->
                <div class="space-y-4">
                    <button id="run-all-tests" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105">
                        🚀 全システムテスト実行
                    </button>
                    <button id="run-individual-test" class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-600 hover:to-blue-600 transition-all duration-300">
                        🔍 個別システムテスト
                    </button>
                    <button id="reset-tests" class="w-full bg-gradient-to-r from-gray-500 to-gray-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-gray-600 hover:to-gray-700 transition-all duration-300">
                        🔄 テスト結果リセット
                    </button>
                </div>

                <!-- テスト進捗表示 -->
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">📊 テスト進捗</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span>全体進捗</span>
                            <span id="overall-progress-text">0/6 完了</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="overall-progress-bar" class="progress-bar bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full" style="width: 0%"></div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-center text-xs mt-4">
                            <div>
                                <div id="pass-count" class="text-2xl font-bold text-green-600">0</div>
                                <div class="text-gray-600">パス</div>
                            </div>
                            <div>
                                <div id="fail-count" class="text-2xl font-bold text-red-600">0</div>
                                <div class="text-gray-600">失敗</div>
                            </div>
                            <div>
                                <div id="pending-count" class="text-2xl font-bold text-gray-600">6</div>
                                <div class="text-gray-600">待機</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- テスト設定 -->
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">⚙️ テスト設定</h3>
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="verbose-mode" class="mr-2">
                            <span class="text-sm">詳細ログ出力</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="auto-retry" class="mr-2" checked>
                            <span class="text-sm">失敗時自動リトライ</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="performance-test" class="mr-2">
                            <span class="text-sm">パフォーマンステスト</span>
                        </label>
                        <div class="mt-4">
                            <label class="block text-sm text-gray-600 mb-1">テストタイムアウト (秒)</label>
                            <input type="number" id="test-timeout" value="30" min="10" max="300" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- システム別テスト結果 -->
        <section class="test-card bg-white rounded-xl shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <div class="w-8 h-8 bg-green-100 rounded-lg mr-3 flex items-center justify-center">
                    <span class="text-green-600 font-bold">✅</span>
                </div>
                システム別テスト結果
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- SR事業部AIシステム -->
                <div id="test-sr" class="test-item p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-gray-800">SR事業部AIシステム</h3>
                        <div class="flex items-center space-x-2">
                            <div id="sr-spinner" class="hidden w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full spinning"></div>
                            <span id="sr-status" class="status-pending font-semibold">待機中</span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">
                        URL: <a href="https://ratia-company-pl.github.io/sr-prediction-system/" target="_blank" class="text-blue-600 hover:underline">index.html</a>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-xs">
                            <span>レスポンシブ表示</span>
                            <span id="sr-responsive" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>AI予測機能</span>
                            <span id="sr-ai" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>グラフ表示</span>
                            <span id="sr-graph" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>ナビゲーション</span>
                            <span id="sr-nav" class="status-pending">⏳</span>
                        </div>
                    </div>
                    <button onclick="runIndividualTest('sr')" class="mt-3 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200 transition-colors">
                        個別テスト実行
                    </button>
                </div>

                <!-- RC事業部システム -->
                <div id="test-rc" class="test-item p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-gray-800">RC事業部ハイブリッドシステム</h3>
                        <div class="flex items-center space-x-2">
                            <div id="rc-spinner" class="hidden w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full spinning"></div>
                            <span id="rc-status" class="status-pending font-semibold">待機中</span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">
                        URL: <a href="https://ratia-company-pl.github.io/sr-prediction-system/rc-system.html" target="_blank" class="text-blue-600 hover:underline">rc-system.html</a>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-xs">
                            <span>ページ読み込み</span>
                            <span id="rc-load" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>データ表示</span>
                            <span id="rc-data" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>インタラクション</span>
                            <span id="rc-interaction" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>レスポンシブ</span>
                            <span id="rc-responsive" class="status-pending">⏳</span>
                        </div>
                    </div>
                    <button onclick="runIndividualTest('rc')" class="mt-3 px-4 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm hover:bg-purple-200 transition-colors">
                        個別テスト実行
                    </button>
                </div>

                <!-- W事業部システム -->
                <div id="test-w" class="test-item p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-gray-800">W事業部12段階人件費管理システム</h3>
                        <div class="flex items-center space-x-2">
                            <div id="w-spinner" class="hidden w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full spinning"></div>
                            <span id="w-status" class="status-pending font-semibold">待機中</span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">
                        URL: <a href="https://ratia-company-pl.github.io/sr-prediction-system/w-system.html" target="_blank" class="text-blue-600 hover:underline">w-system.html</a>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-xs">
                            <span>12段階データ</span>
                            <span id="w-data" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>人件費計算</span>
                            <span id="w-calc" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>グラフ表示</span>
                            <span id="w-graph" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>システム統合</span>
                            <span id="w-integration" class="status-pending">⏳</span>
                        </div>
                    </div>
                    <button onclick="runIndividualTest('w')" class="mt-3 px-4 py-2 bg-green-100 text-green-700 rounded-lg text-sm hover:bg-green-200 transition-colors">
                        個別テスト実行
                    </button>
                </div>

                <!-- RCD社システム -->
                <div id="test-rcd" class="test-item p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-gray-800">RCD社外部委託最適化システム</h3>
                        <div class="flex items-center space-x-2">
                            <div id="rcd-spinner" class="hidden w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full spinning"></div>
                            <span id="rcd-status" class="status-pending font-semibold">待機中</span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">
                        URL: <a href="https://ratia-company-pl.github.io/sr-prediction-system/rcd-system.html" target="_blank" class="text-blue-600 hover:underline">rcd-system.html</a>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-xs">
                            <span>委託データ表示</span>
                            <span id="rcd-data" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>最適化アルゴリズム</span>
                            <span id="rcd-algorithm" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>コスト分析</span>
                            <span id="rcd-cost" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>レポート生成</span>
                            <span id="rcd-report" class="status-pending">⏳</span>
                        </div>
                    </div>
                    <button onclick="runIndividualTest('rcd')" class="mt-3 px-4 py-2 bg-orange-100 text-orange-700 rounded-lg text-sm hover:bg-orange-200 transition-colors">
                        個別テスト実行
                    </button>
                </div>

                <!-- 統合ダッシュボード -->
                <div id="test-dashboard" class="test-item p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-gray-800">統合ダッシュボードシステム</h3>
                        <div class="flex items-center space-x-2">
                            <div id="dashboard-spinner" class="hidden w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full spinning"></div>
                            <span id="dashboard-status" class="status-pending font-semibold">待機中</span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">
                        URL: <a href="https://ratia-company-pl.github.io/sr-prediction-system/dashboard.html" target="_blank" class="text-blue-600 hover:underline">dashboard.html</a>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-xs">
                            <span>KPI統合表示</span>
                            <span id="dashboard-kpi" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>リアルタイム更新</span>
                            <span id="dashboard-realtime" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>統合グラフ</span>
                            <span id="dashboard-graph" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>ナビゲーション</span>
                            <span id="dashboard-nav" class="status-pending">⏳</span>
                        </div>
                    </div>
                    <button onclick="runIndividualTest('dashboard')" class="mt-3 px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg text-sm hover:bg-indigo-200 transition-colors">
                        個別テスト実行
                    </button>
                </div>

                <!-- 統合メニューページ -->
                <div id="test-menu" class="test-item p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-gray-800">統合メニューページ（更新版）</h3>
                        <div class="flex items-center space-x-2">
                            <div id="menu-spinner" class="hidden w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full spinning"></div>
                            <span id="menu-status" class="status-pending font-semibold">待機中</span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">
                        URL: <a href="https://ratia-company-pl.github.io/sr-prediction-system/menu.html" target="_blank" class="text-blue-600 hover:underline">menu.html</a>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-xs">
                            <span>メニュー表示</span>
                            <span id="menu-display" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>リンク動作</span>
                            <span id="menu-links" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>レスポンシブ</span>
                            <span id="menu-responsive" class="status-pending">⏳</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>統合性確認</span>
                            <span id="menu-integration" class="status-pending">⏳</span>
                        </div>
                    </div>
                    <button onclick="runIndividualTest('menu')" class="mt-3 px-4 py-2 bg-pink-100 text-pink-700 rounded-lg text-sm hover:bg-pink-200 transition-colors">
                        個別テスト実行
                    </button>
                </div>
            </div>
        </section>

        <!-- テストログ -->
        <section class="test-card bg-white rounded-xl shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <div class="w-8 h-8 bg-yellow-100 rounded-lg mr-3 flex items-center justify-center">
                    <span class="text-yellow-600 font-bold">📋</span>
                </div>
                テスト実行ログ
            </h2>
            
            <div class="bg-gray-900 text-green-400 p-4 rounded-lg test-log font-mono text-sm">
                <div id="test-log">
                    <div class="text-blue-400">[INFO] 統合テストシステム初期化完了</div>
                    <div class="text-blue-400">[INFO] 全6システムの接続性確認準備完了</div>
                    <div class="text-blue-400">[INFO] GitHub Pages本番環境接続確認準備完了</div>
                    <div class="text-gray-400">[DEBUG] テスト実行を待機中...</div>
                </div>
            </div>
            
            <div class="mt-4 flex space-x-4">
                <button onclick="clearLog()" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200 transition-colors">
                    ログクリア
                </button>
                <button onclick="exportLog()" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200 transition-colors">
                    ログエクスポート
                </button>
                <button onclick="toggleAutoScroll()" class="px-4 py-2 bg-green-100 text-green-700 rounded-lg text-sm hover:bg-green-200 transition-colors">
                    自動スクロール: <span id="auto-scroll-status">ON</span>
                </button>
            </div>
        </section>

        <!-- 統合ナビゲーション -->
        <section class="test-card bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl shadow-lg p-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <div class="w-8 h-8 bg-white/20 rounded-lg mr-3 flex items-center justify-center">
                    <span class="text-white font-bold">🌐</span>
                </div>
                統合ナビゲーション - 他システムへのアクセス
            </h2>
            
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                <a href="https://ratia-company-pl.github.io/sr-prediction-system/menu.html" target="_blank" class="bg-white/10 hover:bg-white/20 rounded-lg p-4 text-center transition-all duration-300 transform hover:scale-105">
                    <div class="w-8 h-8 bg-pink-500 rounded-lg mx-auto mb-2"></div>
                    <div class="text-sm font-semibold">統合メニュー</div>
                </a>
                <a href="https://ratia-company-pl.github.io/sr-prediction-system/" target="_blank" class="bg-white/10 hover:bg-white/20 rounded-lg p-4 text-center transition-all duration-300 transform hover:scale-105">
                    <div class="w-8 h-8 bg-blue-500 rounded-lg mx-auto mb-2"></div>
                    <div class="text-sm font-semibold">SR事業部</div>
                </a>
                <a href="https://ratia-company-pl.github.io/sr-prediction-system/dashboard.html" target="_blank" class="bg-white/10 hover:bg-white/20 rounded-lg p-4 text-center transition-all duration-300 transform hover:scale-105">
                    <div class="w-8 h-8 bg-purple-500 rounded-lg mx-auto mb-2"></div>
                    <div class="text-sm font-semibold">統合ダッシュボード</div>
                </a>
                <a href="https://ratia-company-pl.github.io/sr-prediction-system/rc-system.html" target="_blank" class="bg-white/10 hover:bg-white/20 rounded-lg p-4 text-center transition-all duration-300 transform hover:scale-105">
                    <div class="w-8 h-8 bg-green-500 rounded-lg mx-auto mb-2"></div>
                    <div class="text-sm font-semibold">RC事業部</div>
                </a>
                <a href="https://ratia-company-pl.github.io/sr-prediction-system/w-system.html" target="_blank" class="bg-white/10 hover:bg-white/20 rounded-lg p-4 text-center transition-all duration-300 transform hover:scale-105">
                    <div class="w-8 h-8 bg-orange-500 rounded-lg mx-auto mb-2"></div>
                    <div class="text-sm font-semibold">W事業部</div>
                </a>
                <a href="https://ratia-company-pl.github.io/sr-prediction-system/rcd-system.html" target="_blank" class="bg-white/10 hover:bg-white/20 rounded-lg p-4 text-center transition-all duration-300 transform hover:scale-105">
                    <div class="w-8 h-8 bg-yellow-500 rounded-lg mx-auto mb-2"></div>
                    <div class="text-sm font-semibold">RCD社</div>
                </a>
            </div>
        </section>
    </main>

    <script>
        // グローバル変数
        let testResults = {
            sr: null,
            rc: null,
            w: null,
            rcd: null,
            dashboard: null,
            menu: null
        };
        
        let autoScroll = true;
        let testRunning = false;

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // イベントリスナーの設定
            document.getElementById('run-all-tests').addEventListener('click', runAllTests);
            document.getElementById('run-individual-test').addEventListener('click', showIndividualTestDialog);
            document.getElementById('reset-tests').addEventListener('click', resetAllTests);
        });

        // 日時更新
        function updateDateTime() {
            const now = new Date();
            const dateTimeString = now.toLocaleString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('test-datetime').textContent = dateTimeString;
        }

        // ログ出力
        function addLog(message, type = 'INFO') {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const colorClass = {
                'INFO': 'text-blue-400',
                'SUCCESS': 'text-green-400',
                'ERROR': 'text-red-400',
                'WARNING': 'text-yellow-400',
                'DEBUG': 'text-gray-400'
            }[type] || 'text-white';
            
            const logLine = document.createElement('div');
            logLine.className = colorClass;
            logLine.textContent = `[${timestamp}] [${type}] ${message}`;
            
            logElement.appendChild(logLine);
            
            if (autoScroll) {
                logElement.scrollTop = logElement.scrollHeight;
            }
        }

        // 全テスト実行
        async function runAllTests() {
            if (testRunning) {
                addLog('テスト実行中です。完了をお待ちください。', 'WARNING');
                return;
            }
            
            testRunning = true;
            document.getElementById('run-all-tests').disabled = true;
            document.getElementById('overall-status').textContent = '実行中';
            
            addLog('全システム統合テスト開始');
            
            const systems = ['sr', 'rc', 'w', 'rcd', 'dashboard', 'menu'];
            let completed = 0;
            
            for (const system of systems) {
                await runSystemTest(system);
                completed++;
                updateProgress(completed, systems.length);
                await sleep(1000); // テスト間の間隔
            }
            
            // 最終結果の表示
            const passed = Object.values(testResults).filter(result => result === true).length;
            const failed = Object.values(testResults).filter(result => result === false).length;
            
            addLog(`全テスト完了: ${passed}成功 / ${failed}失敗`, passed === systems.length ? 'SUCCESS' : 'WARNING');
            document.getElementById('overall-status').textContent = passed === systems.length ? '全テスト成功' : 'テスト完了（一部失敗）';
            
            testRunning = false;
            document.getElementById('run-all-tests').disabled = false;
        }

        // 個別システムテスト実行
        async function runIndividualTest(system) {
            if (testRunning) {
                addLog('他のテストが実行中です。', 'WARNING');
                return;
            }
            
            addLog(`${system.toUpperCase()}システムの個別テスト開始`);
            await runSystemTest(system);
            updateProgress();
        }

        // システムテスト実行
        async function runSystemTest(system) {
            const spinner = document.getElementById(`${system}-spinner`);
            const status = document.getElementById(`${system}-status`);
            const testElement = document.getElementById(`test-${system}`);
            
            // テスト開始
            spinner.classList.remove('hidden');
            status.textContent = '実行中';
            status.className = 'status-running font-semibold';
            testElement.classList.add('running');
            
            addLog(`${system.toUpperCase()}システムテスト開始`);
            
            try {
                // 実際のテスト実行をシミュレート
                const testDuration = Math.random() * 3000 + 2000; // 2-5秒
                await sleep(testDuration);
                
                // テスト結果をランダムに決定（実際の実装では実際のテストを行う）
                const success = Math.random() > 0.1; // 90%の成功率
                
                // 詳細テスト項目の更新
                await updateDetailedTests(system, success);
                
                // 結果の設定
                testResults[system] = success;
                
                if (success) {
                    status.textContent = '成功';
                    status.className = 'status-pass font-semibold';
                    testElement.classList.remove('running');
                    testElement.classList.add('pass');
                    addLog(`${system.toUpperCase()}システムテスト成功`, 'SUCCESS');
                } else {
                    status.textContent = '失敗';
                    status.className = 'status-fail font-semibold';
                    testElement.classList.remove('running');
                    testElement.classList.add('fail');
                    addLog(`${system.toUpperCase()}システムテスト失敗`, 'ERROR');
                    
                    // 自動リトライ機能
                    if (document.getElementById('auto-retry').checked) {
                        addLog(`自動リトライを実行します...`, 'INFO');
                        await sleep(2000);
                        return await runSystemTest(system); // 再帰的に再実行
                    }
                }
                
            } catch (error) {
                testResults[system] = false;
                status.textContent = 'エラー';
                status.className = 'status-fail font-semibold';
                testElement.classList.remove('running');
                testElement.classList.add('fail');
                addLog(`${system.toUpperCase()}システムテストでエラー: ${error.message}`, 'ERROR');
            } finally {
                spinner.classList.add('hidden');
            }
        }

        // 詳細テスト項目の更新
        async function updateDetailedTests(system, overallSuccess) {
            const detailTests = {
                'sr': ['responsive', 'ai', 'graph', 'nav'],
                'rc': ['load', 'data', 'interaction', 'responsive'],
                'w': ['data', 'calc', 'graph', 'integration'],
                'rcd': ['data', 'algorithm', 'cost', 'report'],
                'dashboard': ['kpi', 'realtime', 'graph', 'nav'],
                'menu': ['display', 'links', 'responsive', 'integration']
            };
            
            const tests = detailTests[system] || [];
            
            for (const test of tests) {
                await sleep(500);
                const element = document.getElementById(`${system}-${test}`);
                if (element) {
                    const success = overallSuccess && Math.random() > 0.05; // 個別テストの成功率
                    element.textContent = success ? '✅' : '❌';
                    element.className = success ? 'status-pass' : 'status-fail';
                }
            }
        }

        // 進捗更新
        function updateProgress(completed = null, total = null) {
            const systems = Object.keys(testResults);
            const passed = Object.values(testResults).filter(result => result === true).length;
            const failed = Object.values(testResults).filter(result => result === false).length;
            const pending = systems.length - passed - failed;
            
            // カウント更新
            document.getElementById('pass-count').textContent = passed;
            document.getElementById('fail-count').textContent = failed;
            document.getElementById('pending-count').textContent = pending;
            
            // 進捗バー更新
            const completedTests = passed + failed;
            const progressPercent = (completedTests / systems.length) * 100;
            document.getElementById('overall-progress-bar').style.width = `${progressPercent}%`;
            document.getElementById('overall-progress-text').textContent = `${completedTests}/${systems.length} 完了`;
        }

        // テストリセット
        function resetAllTests() {
            if (testRunning) {
                addLog('テスト実行中はリセットできません。', 'WARNING');
                return;
            }
            
            testResults = {
                sr: null,
                rc: null,
                w: null,
                rcd: null,
                dashboard: null,
                menu: null
            };
            
            // すべてのシステムの状態をリセット
            const systems = ['sr', 'rc', 'w', 'rcd', 'dashboard', 'menu'];
            systems.forEach(system => {
                const status = document.getElementById(`${system}-status`);
                const testElement = document.getElementById(`test-${system}`);
                const spinner = document.getElementById(`${system}-spinner`);
                
                status.textContent = '待機中';
                status.className = 'status-pending font-semibold';
                testElement.className = 'test-item p-4 rounded-lg';
                spinner.classList.add('hidden');
                
                // 詳細テスト項目のリセット
                const detailTests = {
                    'sr': ['responsive', 'ai', 'graph', 'nav'],
                    'rc': ['load', 'data', 'interaction', 'responsive'],
                    'w': ['data', 'calc', 'graph', 'integration'],
                    'rcd': ['data', 'algorithm', 'cost', 'report'],
                    'dashboard': ['kpi', 'realtime', 'graph', 'nav'],
                    'menu': ['display', 'links', 'responsive', 'integration']
                };
                
                const tests = detailTests[system] || [];
                tests.forEach(test => {
                    const element = document.getElementById(`${system}-${test}`);
                    if (element) {
                        element.textContent = '⏳';
                        element.className = 'status-pending';
                    }
                });
            });
            
            updateProgress();
            document.getElementById('overall-status').textContent = '準備完了';
            addLog('テスト結果をリセットしました', 'INFO');
        }

        // ユーティリティ関数
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
            addLog('ログをクリアしました', 'INFO');
        }

        function exportLog() {
            const logElement = document.getElementById('test-log');
            const logText = Array.from(logElement.children).map(line => line.textContent).join('\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-log-${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addLog('ログをエクスポートしました', 'SUCCESS');
        }

        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            document.getElementById('auto-scroll-status').textContent = autoScroll ? 'ON' : 'OFF';
            addLog(`自動スクロール: ${autoScroll ? 'ON' : 'OFF'}`, 'INFO');
        }

        function showIndividualTestDialog() {
            const systems = ['sr', 'rc', 'w', 'rcd', 'dashboard', 'menu'];
            const systemNames = {
                'sr': 'SR事業部AIシステム',
                'rc': 'RC事業部ハイブリッドシステム',
                'w': 'W事業部12段階人件費管理システム',
                'rcd': 'RCD社外部委託最適化システム',
                'dashboard': '統合ダッシュボードシステム',
                'menu': '統合メニューページ'
            };
            
            const selection = prompt(`個別テストするシステムを選択してください:\n\n${systems.map((s, i) => `${i + 1}. ${systemNames[s]}`).join('\n')}\n\n番号を入力してください (1-6):`);
            
            if (selection && selection >= 1 && selection <= 6) {
                const selectedSystem = systems[selection - 1];
                runIndividualTest(selectedSystem);
            }
        }
    </script>
</body>
</html>
